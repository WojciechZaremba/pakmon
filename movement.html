<!DOCTYPE html>
<html>
<head>
    <title>movement testing</title>
    <style>
        body {
            background-color: black;
        }
        canvas {
            border: 1px solid white;
            margin: 45px;
        }
    </style>
</head>
<body>
    <canvas id="canvas" width="300" height="250"></canvas>
    <script>

const my_canvas = document.getElementById("canvas")
const ctx = my_canvas.getContext("2d")

let playerCell = 11
let targetCell = 10
let keyPressed = ""

function drawGrid() {
    for (let i = 1; i < 6; i++) {
        for (let j = 1; j < 5; j++) {
            ctx.beginPath()
            ctx.fillStyle = "white"
            ctx.rect(i * 50 - 2, j * 50 - 2, 4, 4)
            ctx.fill()
        }
    }
}

function drawPlayer() {
    const xp = playerCell % 6
    const yp = Math.floor(playerCell / 6)
    
    const xt = targetCell % 6
    const yt = Math.floor(targetCell / 6)
    
    ctx.beginPath()
    ctx.fillStyle = "orange"
    ctx.rect(xt * 50, yt * 50, 50, 50)
    ctx.fill()
    
    ctx.beginPath()
    ctx.arc(xp * 50 + 25, yp * 50 + 25, 25, 0, Math.PI * 2)
    ctx.fillStyle = "yellow"
    //ctx.rect(xp * 50, yp * 50, 50, 50)
    ctx.fill()
}

function animateBetween() {
    const xp = playerCell % 6
    const yp = Math.floor(playerCell / 6)
    
    const xt = targetCell % 6
    const yt = Math.floor(targetCell / 6)

    const xStep = (xt - xp) * 5
    const yStep = (yt - yp) * 5

    function next(offsetX, offsetY, frame) {
        frame = frame + 1
        offsetX = offsetX + xStep
        offsetY = offsetY + yStep

        ctx.clearRect(0, 0, 300, 250)
        drawGrid()
    
        ctx.beginPath()
        ctx.fillStyle = "orange"
        ctx.rect(xt * 50, yt * 50, 50, 50)
        ctx.fill()
    
        ctx.beginPath()
        ctx.arc(xp * 50 + 25 + offsetX, yp * 50 + 25 + offsetY, 25, 0, Math.PI * 2)
        ctx.fillStyle = "yellow"
        //ctx.rect(xp * 50, yp * 50, 50, 50)
        ctx.fill()

        setTimeout(() => {
            if (frame >= 10) return
            next(offsetX, offsetY, frame)
        }, 30)
    }
    next(0, 0, 0)

}

function handleKey(e) {
    switch (e.key) {
        case "ArrowRight":
            targetCell = playerCell + 1
        break
        case "ArrowLeft":
            targetCell = playerCell - 1
        break
        case "ArrowUp":
            targetCell = playerCell - 6
        break
        case "ArrowDown":
            targetCell = playerCell + 6
        break
        case "w":
            const prevPla = playerCell
            const nextPla = targetCell
            const nextTar = nextPla - prevPla + nextPla

            playerCell = nextPla
            targetCell = nextTar
            break
            case "q":
            animateBetween()
            return
        break
    }

    if (playerCell % 6 === 0 && playerCell - targetCell === 1) {
        console.log("crossed left wall")
        targetCell = playerCell
    } else if ((playerCell + 1) % 6 === 0 && playerCell - targetCell === -1) {
        console.log("crossed right wall")
        targetCell = playerCell
    } else if (playerCell >= 24 && playerCell - targetCell === -6) {
        console.log("crossed bottom wall")
        targetCell = playerCell
    } else if (playerCell < 6 && playerCell - targetCell === 6) {
        console.log("crossed top wall")
        targetCell = playerCell
    }
    
    frame()
}

function makeMove() {
    const prevPla = playerCell
    const nextPla = targetCell
    const nextTar = nextPla - prevPla + nextPla

    playerCell = nextPla
    targetCell = nextTar

    if (playerCell % 6 === 0 && playerCell - targetCell === 1) {
        console.log("crossed left wall")
        targetCell = playerCell
    } else if ((playerCell + 1) % 6 === 0 && playerCell - targetCell === -1) {
        console.log("crossed right wall")
        targetCell = playerCell
    } else if (playerCell >= 24 && playerCell - targetCell === -6) {
        console.log("crossed bottom wall")
        targetCell = playerCell
    } else if (playerCell < 6 && playerCell - targetCell === 6) {
        console.log("crossed top wall")
        targetCell = playerCell
    }


    frame()
}
        
function frame() {
    ctx.clearRect(0, 0, 300, 250)
    drawGrid()
    drawPlayer()
}

frame()

document.addEventListener("keydown", handleKey)









    </script>
</body>
</html>