<!DOCTYPE html>
<html>
<head>
    <title>movement testing</title>
    <style>
        body {
            background-color: black;
        }
        canvas {
            border: 1px solid white;
            margin: 45px;
            margin-bottom: 0px;
        }
        div {
            color: white;
        }
    </style>
    
</head>
<body>
    <canvas id="canvas" width="300" height="250"></canvas>
    <div id="par1">Current direction:</div>
    <div id="par2">Queued direction: </div>
    <div id="par3">Player cell: </div>
    <div id="par4">Target Cell: </div>
    <div id="par5">Coins left: </div>
    <div id="par6"></div>

<script>

const my_canvas = document.getElementById("canvas")
const ctx = my_canvas.getContext("2d")

const canvasWidth = 300
const canvasHeight = 250

my_canvas.width = canvasWidth
my_canvas.height = canvasHeight

const rowsNum = 5
const columnsNum = 6
const gridRows = rowsNum * 2
const gridColumns = columnsNum * 2

const cellWidth = canvasWidth / gridColumns
const cellHeight = canvasHeight / gridRows

const level = [[6,1],[0,7,2],[1,3],[2,9],[10,5],[4],[0,12],[1,8,13],[9,7],[3,8,10],[11,9,4],[17,10],[18,6],[7,14],[13,20,15],[21,14],[17,22],[16,11,23],[19,12,24],[20,18],[14,19],[27,15,22],[21,16],[17,29],[18,25],[24,26],[25,27],[26,21,28],[27],[23]]

const levelFormatted = {}

function formatLevel() { // adds a cell between every "level" cell
    for (let i = 0; i < level.length; i++) {
        const floor = Math.floor(i / columnsNum)
        const skip = floor * (columnsNum - 1) * 2
        const newIdx = i * 2 + skip

        levelFormatted[newIdx] = []
        
        level[i].forEach(pass => {
            let diff = pass - i
            if (diff === -6) diff = -11
            else if (diff === 6) diff = 11
            const newPass = newIdx + diff
            levelFormatted[newIdx].push(newPass)

            if (levelFormatted[newPass] === undefined) levelFormatted[newPass] = []
            if (levelFormatted[newPass].indexOf(newIdx) == -1) levelFormatted[newPass].push(newIdx)
        })
    }
}
formatLevel()

// console.log(level.length)
// for (let i = 0; i < level.length; i++) {
//     const floor = Math.floor(i / columnsNum)
//     const skip = floor * (gridColumns - 2)
//     const newIdx = i * 2 + skip
   
    // console.log(i, i*2, skip, i*2 + skip)
    
    // const yNum = Math.floor(i / (gridColumns - 1))
    // if (yNum % 2 !== 0) continue

    // console.log(i)



    // LevelFormatted[i*2] = []
    // level[i].forEach(pass => {
    //     const direction = pass - i
    //     const newIdx = i * 2
    //     let newPass = newIdx + direction

    //     if (direction == 6 || direction == -6) {
    //         newPass = -99
    //         // newPass = newIdx + direction * 2 - 1
    //     }

    //     LevelFormatted[newIdx].push(newPass)

    //     //console.log(i, pass)

    //     //LevelFormatted[i*2].push(pass)
    // })
// }

const levelMap = level.map(elem => {
    const mapped = []
    elem.forEach(passage => {
        mapped.push(passage * 2)
    })
    return mapped
})

const coinsGrid = []

drawGrid()
drawWalls()
createCoinsGrid()
drawCoins()

function drawGrid() {
    for (let i = 1; i < gridRows; i++) {
        for (let j = 1; j < gridColumns; j++) {
            ctx.beginPath()
            ctx.fillStyle = "darkgray"
            ctx.rect(j * cellWidth - 2, i * cellHeight - 2, 1, 1)
            ctx.fill()
        }
    }
}

function drawWalls() {
    ctx.beginPath()
    ctx.fillStyle = "red"
    for (let i = 0; i < level.length; i++) {
        const x = i % columnsNum
        const y = Math.floor(i / columnsNum)
        if (level[i].indexOf(i + 6) === -1) {
            ctx.rect(
                x * cellWidth * 2,
                y * cellHeight * 2 + cellHeight * 2,
                55, 5)
        }
        if (level[i].indexOf(i + 1) === -1) {
            ctx.rect(
                x * cellWidth * 2 + cellHeight * 2,
                y * cellHeight * 2,
                5, 55)
            }
        }
    ctx.fill()
}

function createCoinsGrid() {
    console.log("create coins grid")
    
    const cellsAvaiable = Object.keys(levelFormatted)
    console.log(cellsAvaiable)

    cellsAvaiable.forEach(cell => coinsGrid.push(Number(cell)))

    // for (let i = 0; i < gridColumns - 1; i++) coinsGrid.push([])

    // coinsGrid.forEach(row => {
    //     for (let i = 0; i < gridRows - 1; i++) {
    //         row.push("coin")
    //     }
    // })

    // for (let i = 0; i < levelMap.length; i++) {
    //     const x = i % columnsNum
    //     const y = Math.floor(i / columnsNum)
        
    //     // const curr = i * 2
    //     // const next = curr + 1
    //     // console.log(curr, next)
    // }
    // console.log(coinsGrid)
}

function drawCoins() {
    ctx.fillStyle = "yellow"
    console.log(gridColumns)
    console.log(gridRows)

    coinsGrid.forEach(coin => {
        console.log(coin)
        console.log(coin % 11, coin / 11)
        
        const x = coin % 11 + 1
        const y = Math.floor(coin / 11) + 1

        ctx.font = "10px Comic Sans MS"
        ctx.fillStyle = "purple"
        ctx.fillText(`${coin}`, x * 25, y * 25)
        
        ctx.fillStyle = "yellow"
        ctx.beginPath()
        ctx.arc(x * 25, y * 25, 4, 0, Math.PI * 2)
        ctx.fill()
        
        // const x = (coin % (gridColumns - 1))
        // const y = Math.floor(coin / gridColumns - 1)
        // console.log(x, y)
        // ctx.beginPath()
        // ctx.arc((x) * 25, (y) * 25, 1, 0, Math.PI * 2)
        // ctx.fill()
        // ctx.font = "20px Comic Sans MS"
        // ctx.fillStyle = "yellow"
        // ctx.fillText(`${coin}`, x * 25, y * 25)
    })
    
    // for (let x = 0; x < coinsGrid.length; x++) {
    //     for (let y = 0; y < coinsGrid[0].length; y++) {
    //         if (coinsGrid[x][y] === "coin") {
    //             ctx.beginPath()
    //             ctx.arc((x+1) * 25, (y+1) * 25, 2, 0, Math.PI * 2)
    //             ctx.fill()
    //         }
    //     }
    // }

    // for (let i = 0; i < level.length; i++) {
    //     let x = i % 6 * 2
    //     let y = Math.floor(i / 6) * 2
    // }

    // for (let i = 0; i < rowsNum; i++) {
    //     for (let j = 0; j < columnsNum; j++) {
    //         ctx.beginPath()
    //         ctx.arc(
    //             j * 2 * 25 + 25,
    //             i * 2 * 25 + 25,
    //             3, 0, Math.PI * 2)
    //         ctx.fill()
    //     }
    // }
}


</script>

</body>
</html>